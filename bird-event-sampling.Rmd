---
title: "Explore"
output: github_document
---

```{r}
library(lubridate)
library(tidyverse)
```


```{r}
bird <- readRDS("cache/bird.rds")
brd_df <- bird$brd_countdata
```


Let's find a relatively complicated event
```{r}
exciting_event <- brd_df %>% count(eventID, sort=TRUE) %>% head(1) %>% pull(eventID) 
```


By definition, these occur at the same location: (siteID, plotID, pointID), and time (startDate).  So let's drop the info that's shared across all (65) entries in this event `eventID ("LAJA_001.21.2018-05-26T07:01-04:00[America/Puerto_Rico]")`

```{r}
df <- brd_df %>%  
  filter(eventID == exciting_event) %>% 
  select(-siteID, -plotID, -pointID, -eventID, -uid,
         -namedLocation, -domainID, -plotType,
         -startDate, -publicationDate)
df
```


Let's focus on just the most commonly seen of the 18 species observed in this event (looks to be `"Tyrannus dominicensis"`).  Again, we'll drop the fields that shared across all entries

```{r}
common <- df %>% count(scientificName, sort = TRUE) %>% head(1) %>% pull(scientificName)
kingbird <- df %>% filter(scientificName == common) %>% select(-taxonID, -scientificName, -taxonRank, -vernacularName, -family)
kingbird
```

Looks like we have 2 observers (IRC and EFN), with IRC identifying by `singing` and EFN by `visual`. We also get observations by minute of the six-minute interval

```{r}
ex <- kingbird %>% 
  select(pointCountMinute, clusterSize, observerDistance, 
         detectionMethod, identifiedBy, visualConfirmation) %>% 
  arrange(pointCountMinute)

```

How shall we estimate a species density from this data?  Apparently, research interpets this question through the lens of "detection probability" as if there were a "true", uniform density of birds over the landscape (which we seek to estimate) but he probability that an observer sees a bird is a function only of the distance to the observer and the unknown density.  (Guessing social behavior of flocks is going to be hard to include?)

Of course our sampling probability may differ across species and location-specific variables such as plotType / domainID, as well as some temporal dependence; presumably a generic model will allow us to account for these parametrically to borrow power across these events.  We will revisit these issues after considering what a density estimate looks like when those differences across space/time/species are held fixed. 

To simplify a step further first, let us consider a single detection method / observer as well:

```{r}
min_ex <- ex %>% 
  filter(detectionMethod == "singing") %>% 
  select(pointCountMinute, clusterSize, observerDistance)
```


Of course we want to leverage prior art in this analysis as well.  One line of analysis is the class of distance based methods, e.g. [Buckland et al](https://doi.org/10.1007/978-3-319-19219-2 "Distance Sampling: Methods and Applications").  This group appears to have a substantial suite of [associated software](https://github.com/DistanceDevelopment/Distance), including the [`Distance` R package](https://cran.r-project.org/web/packages/Distance/) described [in JSS](https://doi.org/10.18637/jss.v089.i01). 

Perhaps these methods could be applied in an appropriate pipeline to create a higher-level data product summarizing abundance efforts, which would be the focus of further analysis and any forecasting predictions.

I am also curious if it is reasonable to forecast the 'observed data' directly without invoking the concept of abundance, and if so, what it would mean.  

